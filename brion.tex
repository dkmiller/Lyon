% !TEX root = main.tex

\section{Possibly non-affine algebraic groups}
\thanksauthor{Michel Brion}



Our topic is the structure of algebraic groups (possibly non-affine) over 
a field (possibly non-perfect). 

\begin{theo}[Chevalley, Barsotti, Rosenlicht]\label{thm:A}
Let $G$ be a connected algebraic group over a perfect field. Then there exists 
a largest connected linear subgroup $L\subset G$. Moreover, $L$ is normal 
in $G$ and $G/L$ is an abelian variety. 
\end{theo}

In other words, every algebraic group is the extension of an abelian variety by 
an affine algebraic group. 

\begin{theo}[Rosenlicht, Demazure-Gabriel]\label{thm:B}
Let $G$ be a group scheme of finite type over a field $k$. Then $G$ has a 
largest linear quotient $L'$, i.e.~a smallest normal subgroup scheme $H$ such 
that $G/H$ is linear. Moreover, $H$ is smooth, connected, commutative, and 
$\sO(H) = \Gamma(H,\sO_H) = k$. 
\end{theo}

These theorems are ``dual'' in some informal sense. Note that the assumptions 
of Theorem \ref{thm:B} are much weaker. The group $H$ in Theorem \ref{thm:B} 
is an abelian variety when $k$ is perfect. 
A good reference is \cite{m14}. 

\begin{defi}
A \emph{$k$-group scheme} is a scheme $G$ over $k$, equipped with morphisms 
$m:G\times G\to G$ (multiplication), $i:G\to G$ (inverse) and 
$e\in G(k)$ (identity) such that for all $k$-schemes $S$, these give 
$G(S)$ the structure of a group. An \emph{algebraic group} is a smooth group 
scheme of finite type. 
\end{defi}

\emph{Warning}: this definition is less restrictive than Gille's. 

If $k=\bar k$, then this is the same notion as in \cite{b91} or \cite{s09}. 
They identify $G$ with the set $G(k)$ of $k$-points. 
Every group scheme is separated, i.e.\ the diagonal $\Delta_G\subset G\times G$ 
is closed. 

Let $K/k$ be a field extension, $G$ a $k$-group scheme. Then 
$G_K=G\times_{\spectrum(k)} \spectrum(K)$ is the base-extension of $G$ to 
$K$. The functor $(-)_K$ commutes with products, so $G_K$ is a $K$-group 
scheme. 

Our main examples of algebraic groups are the \emph{additive group} 
$\dG_\additive$, the \emph{multiplicative group} $\dG_\mult$, and the 
\emph{general linear group} $\generallinear_n$. These are easily defined 
via their functors of points. A \emph{linear group scheme} is a (closed) 
subgroup scheme of some $\generallinear_n$. It turns out that for 
$k$-groups, linear $\Leftrightarrow$ affine of finite type. We can regard 
$\generallinear_n$ as a closed subgroup of $\speciallinear_{n+1}$ in the 
usual way. 

Recall that closed subgroup schemes of $\dG_\additive$ correspond to 
(certain) 
ideals $I\subset \sO(\dG_\additive) = k[t]$. Such ideals will be 
generated by a polynomial $f\in k[t]$. Such a polynomial needs to 
satisfy $f(x+y) \in \langle f(x),f(y)\rangle \subset k[x,y]$, 
$f(0)=0$, and $f(-t) \in \langle f\rangle$. Some elementary manipulations 
show that if $k$ has characteristic zero, such an $f$ must be of the 
form $a t$ for $a\in k^\times$. In characteristic $p>0$, such an $f$ can 
be any of the polynomials $\sum_{i\geqslant 1} a_i t^{p^i}$. These are 
called \emph{$p$-polynomials}. For a $p$-polynomial $f$, the subgroup 
scheme $V(I)\subset \dG_\additive$ will be nonreduced. For each 
$n\geqslant 1$, we get a scheme $\boldsymbol\mu_n\subset \dG_\mult$ defined 
by 
\[
  \boldsymbol\mu_n(A) = \{a\in A^\times:a^n=1\} .
\]

Our final example of group schemes are \emph{elliptic curves}. For us, 
an elliptic curve over $k$ is a smooth projective curve $E$ of genus $1$ 
with a distinguished point $0\in E(k)$. Using Riemann-Roch, such a curve 
embeds into $\dP_k^2$. If $6\in k^\times$, then 
$E$ has affine form $y^2=x^3+a x+b$, the standard equation for an elliptic 
curve. One defines a group law on $E$ in the usual way. 

For a group scheme $G$, locally of finite type over $k$, the following 
conditions are equivalent:
\begin{enumerate}
  \item $G$ is smooth
  \item $G$ is geometrically reduced
  \item $\sO_{G,e}\otimes_k \bar k$ is reduced
\end{enumerate}
If $k$ has characteristic zero, then \emph{all} $k$-groups locally of 
finite type are smooth. In general, we have a largest reduced 
subscheme $G_\reduced\subset G$; this is a group scheme if $k$ is 
perfect. 





\subsection{Homogeneous spaces and quotients}

The reference here is \cite[VI$_\mathrm{A}$ \S 3]{sga3}. Let $G$ be a $k$-group 
scheme, locally of finite type, and $H\subset G$ a subgroup scheme. Then there is 
a morphism of schemes $q:G\to G/H$ such that $q$ is $H$-invariant (i.e.~if 
$m,p:G\times H\to G$ are the multiplication and projection morphisms, we have 
$q m = q p$) and any $H$-invariant morphism $G\to X$ factors uniquely 
through $q$. Moreover, $q$ is faithfully flat, and the diagram 
\[\xymatrix{
  G\times H \ar[r]^-m \ar[d]^-p  
    & G \ar[d]^-q \\
  G \ar[r]^-q 
    & G/H 
}\]
is cartesian. It follows that $q:G\to G/H$ is an $H$-torsor (for the 
fppf topology). The map $q$ is locally of finite type. 

If $H\subset G$ is normal, then the quotient $G/H$ has the structure of 
a group scheme, uniquely characterized by the property that 
$q:G\to G/H$ is a morphism of group schemes. 

\begin{enonce}{Example}
Let $G=\dG_\mult$ and $H=\boldsymbol\mu_n$. Then $G/H=\dG_\mult$ via the 
$n$-th power map $x\mapsto x^n$. But the map $G(k) \to (G/H)(k)$ is usually 
not surjective. But the map $G(\bar k) \to (G/H)(\bar k)$ is surjective. 
\end{enonce}

If we worked over an arbitrary base ring $k$, we would need to pass to 
fppf extensions in order for $G\to G/H$ to be pointwise surjective. In 
other words, for $s\in (G/H)(A)$, there is an fppf cover $A\to B$ and 
$\widetilde s\in G(B)$ such that $\widetilde s|_A = s$. 

If $G$ is smooth, so is $G/H$. 

if $G$ and $H$ are affine, $\sO(G/H)=\sO(G)^H$. (Here 
$\sO(G)^H$ consists of $H$-invariant morphisms $G\to \dA^1$.)





\subsection{Lie algebras}

Let $G$ be a $k$-group scheme. Let $k[\tau]=k[t]/(t^2)$. Consider the base 
change $G_{k[\tau]}$ as a $k$-group scheme. The maps $k\rightleftarrows k[\tau]$ 
induce morphisms $G_{k[\tau]} \leftrightarrows G$. It turns out that 
$G_{k[\tau]} = G\ltimes \ker(\pi)$, where $\pi:G_{k[\tau]} \to G$ is the canonical 
projection. Now $\pi:G_{k[\tau]}\to G$ is the ``tangent bundle'' of 
$G$, so its fiber $\pi^{-1}(g)$ for $g\in G(k)$ is the tangent space 
$T_g G$. In particular, $\pi^{-1}(0) = \lie G$. Since $\lie G$ lives in the 
semidirect product $G_{k[\tau]} = G\ltimes \ker(\pi)$, it has an action of 
$G$ by conjugation. If we put $\frakg=\lie G$, this gives a homomorphism 
$\adjoint:G\to \generallinear(\frakg)$. Differentiating this gives a representation 
(also called the adjoint representation) 
$\adjoint:\frakg \to \lie(\generallinear\frakg) = \End(\frakg)$. Define 
$[x,y] = \adjoint(x) y$; this is the usual bracket on $\frakg$. 


\subsection{Neutral component}

Let $G$ be a $k$-group scheme, locally of finite type. Let $G^\circ$ be the 
connected component of $e$ in $G$. Then $G^\circ$ is a normal subgroup scheme 
of $G$, and the quotient $G/G^\circ$ is \'etale (smooth of dimension $0$). The 
group $G^\circ$ is of finite type, and is geometrically irreducible. 

\begin{enonce}{Example}[automorphism group schemes]
Let $X$ be a $k$-scheme. Define a functor $\automorphism_X$ on $k$-schemes 
by $\automorphism_X(S) = \automorphism_{S\textnormal{-}\mathsf{sch}}(X_S)$. 
Grothendieck proved that if $X$ is proper, then $\automorphism_X$ is represented by a 
$k$-group scheme, locally of finite type. One has 
$\lie(\automorphism_X) = \operatorname{Der}_k(\sO_X) = \h^0(X,T_X)$. Suppose 
$X$ is projective. Then to $f\in \automorphism_X(S)$, we can associate its 
graph $\Gamma_f\subset (X\times X)_S$. So the automorphisms of $X$ are 
parameterized by an open subscheme of the Hilbert scheme of $X$. The Hilbert 
scheme is projective, so $\automorphism_X$ is quasi-projective. 
\end{enonce}

When $X$ is proper, then there is an alternative construction of 
Matsumura-Oort using a general representability criterion. 
For the simplest types of projective varieties (projective space) everything 
can be written down. One has $\automorphism_{\dP(V)} = \generallinear(V)$. 
If $X$ is a smooth projective curve of genus $0$, then we can write 
$X\simeq V(q)\subset \dP^2$ for a quadratic form $q$. One has 
$\automorphism_X=\operatorname{PO}(q)$; this is a $k$-form of 
$\projectivegenerallinear_2$. 

For $X$ a nice curve of genus $1$, then $\automorphism_X^\circ$ is an 
elliptic curve, and the component group $\automorphism_X/\automorphism_X^\circ$ 
is finite. If $X$ is a nice curve of genus $g\geqslant 2$, then 
$\automorphism_X$ is finite. 

For smooth projective surfaces $X$, the quotient group 
$\automorphism_X/\automorphism_X^\circ$ may be infinite. For example, if 
$X=E\times E$ for $E$ an elliptic curve, then $\automorphism_X^\circ=E\times E$. 
But $\pi_0(\automorphism_X)\supset \generallinear_2(\dZ)$. 

[Here I write $\pi_0 G$ for the quotient $G/G^\circ$.]

It is currently an open problem whether $\pi_0(\automorphism_X)$ is 
finitely generated for $X$ a smooth projective variety. 

Even if $X$ is a smooth projective surface, the group $\automorphism_X$ may 
not be reduced. A good example is an Igusa surface in characteristic $2$. 
Let $E,F$ be elliptic curves. Let $X=(E\times F)/\sigma$, where 
$\sigma$ is the involution defined by 
$\sigma(x,y) = (-x,y+y_0)$, where $y_0\in F(k)$ is chosen to have order $2$. 
In characteristic $2$, $T_X$ is trivial! 
Now $\lie(\automorphism_X)=k^2$. Let 
$\pi:E\times F\to X$ be the quotient map. This is \'etale, so 
$\pi^\ast T_X = (T_{E\times F})^\sigma = (\sO_{E\times F}^2)^\sigma = \sO_{E\times F}^2$, 
in characteristic $2$. 

An open question: which group schemes occur as $\automorphism_X^\circ$ for 
$X$ proper, normal? Over perfect fields, all connected algebraic groups occur. 

\begin{enonce}{Example}
Let $E$ be an elliptic curve with origin $0\in E(k)$. Let $L\to E$ be a line 
bundle. Then $L\smallsetminus \{\text{zero section}\}$ is a $\dG_\mult$-bundle 
on $E$. The map $\pi:L\smallsetminus0 \to E$ is in fact a (Zariski-locally 
trivial) $\dG_\mult$-torsor. This induces a class $[L]\in \h^1(E,\dG_\mult)$. 
We claim that if $\deg(L)=0$, then $G=L\smallsetminus 0$ has the unique structure 
of a commutative group such that $1 \to \dG_\mult \to G \xrightarrow\pi E \to 0$ 
is exact. This result is due to Serre. This is an example of the sequence produced 
by Theorem \ref{thm:A}. We would like to see how this fits into Theorem 
\ref{thm:B}. To do this, we need to compute $\sO(G)$. We compute 
\begin{align*}
  \sO(G) &= \h^0(G,\sO_G) \\
    &= \h^0(E,\pi_\ast \sO_G) \\
    &= \h^0\left(E,\bigoplus_{n\in \dZ} L^n\right) \\
    &= \bigoplus_{n\in \dZ} \h^0(E,L^n) .
\end{align*}
As an exercise, show that if $M\to E$ is a line bundle of degree $0$, then 
$\h^0(E,M)\ne 0$ if and only if $M\simeq \sO_E$. If $L$ has infinite order 
in $\operatorname{Pic} E$, then all $L^n\not\simeq M$, so $\sO(G)=k$. If 
$L$ has order $m$, then $\sO(G)=\simeq k[t^{\pm 1}]$, where 
$\deg t=m$. We have obtained a morphism $G\to \dG_\mult$. We claim that this 
fits into an exact sequence 
\[
  1 \to F \to G \to \dG_\mult \to 1 ,
\]
where $F$ is an elliptic curve. The map $\pi:G\to E$ induces an isogeny 
$F\twoheadrightarrow E$ of degree $m$. 
\end{enonce}





\subsection{Proof of ``Theorem B''}

\begin{lemm}
Let $G$ be a group scheme of finite type over $k$. Then the following are 
equivalent:
\begin{enumerate}
  \item $G$ is linear
  \item $G$ is affine 
  \item $G_{\bar k}$ is affine
  \item $(G_{\bar k})_\reduced$ is affine
\end{enumerate}
\end{lemm}
\begin{proof}
Clearly $1 \Rightarrow 2 \Rightarrow3\Rightarrow 4$. Moreover, 
$2\Rightarrow 1$ exactly as for algebraic groups (as in Borel's book). The 
non-trivial part is $4\Rightarrow 3$, which holds for any scheme of finite 
type (also noetherian). This is an exercise in Hartshorne. The implication 
$3\Rightarrow 2$ is a type of descent. Recall that a scheme $X$ is affine if 
and only if the functor $\h^0:\mathsf{qc}(X) \to \mathsf{Vect}_k$ is 
exact. But $\h^0(G_{\bar k},\sF) = \h^0(G,\sF)_{\bar k}$ (just use the 
\v Cech complex). This is exact, so we're done. 
\end{proof}

\begin{lemm}
Let $G$ be a linear group scheme, $\pi:X\to Y$ a $G$-torsor. Then the morphism 
$\pi$ is affine. 
\end{lemm}
\begin{proof}
We know that $\pi$ is faithfully flat, $G$ acts on $X$, $\pi$ is $G$-invariant, 
and the diagram 
\[\xymatrix{
  G\times X \ar[r]^-m \ar[d]^-p 
    & X \ar[d]^-\pi \\
  X \ar[r]^-\pi 
    & Y
}\]
is Cartesian (this is what it means for $X$ to be a $G$-torsor over $Y$). 
Let $V\subset Y$ be affine open, $U=\pi^{-1}(V)$. We need to prove that 
$U$ is also affine. We do this by proving that $\h^0(U,-)$ is exact. But 
this is $\h^0(V,\pi_\ast -)$. But $V$ is affine, so $\h^0(V,-)$ is 
exact. All that remains is to prove that $(\pi|_U)_\ast$ is exact. We have a 
cartesian diagram 
\[\xymatrix{
  G\times U \ar[r]^-m \ar[d]_p 
    & U \ar[d]^-{\pi|_U} \\ 
  U \ar[r]^-{\pi|_U} 
    & V .
}\]
One has $\pi_U^\ast \pi_{U\ast} \simeq p_\ast m^\ast$. Since 
$\pi_U^\ast$ is exact, it suffices to show that 
$\pi_U^\ast \pi_{U\ast} = p_\ast m^\ast$ is exact. But $m^\ast$ is exact by 
faithful flatness, and $p_\ast$ is exact because $p$ is affine. 
\end{proof}

\begin{prop}
Let $G$ be a group scheme of finite type, $H\subset G$ a normal subgroup 
scheme. Then $G$ is affine if and only if $H$ and $G/H$ are affine. 
\end{prop}
\begin{proof}
We may assume $k=\bar k$. 

$\Rightarrow$. Clearly closed subgroups $H\subset G$ are affine. The fact that 
$G/H$ is affine is harder -- see \cite{b91} for a proof that 
$G_\reduced/H_\reduced$ is affine. But we need to show that 
$(G/H)_\reduced$ is affine. There is a map 
$G_\reduced/H_\reduced \to (G/H)_\reduced$, which is a group homomorphism. 
It is a bijection on $\bar k$-points. Let $K$ be its (scheme-theoretic) 
kernel. The scheme $K$ is of finite type, and has a unique $k$-point. This 
implies that $K$ is a finite group scheme. In \cite{m08} for a proof of the 
fact that if $X$ is an affine group scheme, and $K$ is a finite group scheme acting 
on $X$ then $X/K$ is affine. 
\end{proof}

Equivalently, affine groups are stable under extensions. 


\subsubsection{Affinization}

Let $X$ be a $k$-scheme. Then there is a universal morphism from $X$ to an affine 
scheme -- namely $\varphi_X:X \to \spectrum \sO(X)$. One has 
\[
  \hom_{k\textnormal{-}\mathsf{sch}}(X,\spectrum A) = \hom_{k\textnormal{-}\mathsf{alg}}(A,\sO(X)) .
\]
\emph{Warning}: if $X$ is of finite type, then $\sO(X)$ may not be!

\begin{enonce}{Example}
Let $L\to E$ be a line bundle of infinite order as before. Let $M \to E$ be a 
line bundle of negative degree. Consider the vector bundle 
$X=L\oplus M$ over $E$. One has 
\[
  \sO(X) = \bigoplus_{m,n\geqslant 0} L^{-m} \otimes M^{-n} .
\]
[\ldots stuff I didn't understand\ldots]
\end{enonce}

Note that $\varphi_X$ commutes with products (since 
$\sO(X\times Y) = \sO(X)\otimes_k \sO(Y)$). Thus, if $G$ is a group scheme, then 
$\spectrum \sO(G)$ is an affine group scheme, and $\varphi_G$ is a homomorphism. 

\begin{theo}
If $G$ is of finite type, then $H=\ker(\varphi)$ is the smallest normal subgroup 
scheme of $G$ such that $G/H$ is affine. Moreover, $\sO(H)=k$ and 
$\sO(G)=\sO(G/H)$. In particular, $G/H=\spectrum \sO(G$ is finitely generated. 
\end{theo}
\begin{proof}
Let $H_1\subset G$ be normal such that $G/H_1$ is affine. Then 
$G\to G/H_1$ factors through $\varphi_X$ as in 
\[\xymatrix{
  G \ar[r]^-\varphi \ar[dr]_-q 
    & \spectrum \sO(G) \ar@{.>}[d] \\
  & G/H_1 .
}\]
Then $H=\varphi^{-1}(1) \subset H_1=q^{-1}(1)$. It remains to show that $G/H$ is 
affine. Write $\sO(G)=\bigcup V_i$, where each $V_i$ is a $G$-stable finite-dimensional 
subspace of $\sO(G)$. Then $H$ is the kernel of the right $G$-action on 
$\sO(G)$, i.e. 
\[
  H = \bigcap_i \ker(G \to \generallinear(V_i)) .
\]
By noetherianness, $H=\ker(G\to \generallinear(V_{i_0}))$ for some $i_0$, 
so snce $G/H \to \generallinear(V_{i_0})$ has trivial kernel, it is a 
closed immersion by a theorem proved by Gille. 

[\ldots didn't follow whole proof\ldots]
\end{proof}

\begin{theo}[Demazure-Gabriel]
Let $G$ be a $k$-group scheme of finite type such that $\sO(G)=k$. Then $G$ 
is smooth, connected, and every homomorphism $G\to H$ (the latter a connected 
group scheme) factors through the center of $H$. 
\end{theo}
\begin{proof}
Since $\sO(G_{\bar k}) = \sO(G)_{\bar k}$, we may assume $k=\bar k$. Note that 
$\pi_0 G = G/G^\circ$ is a finite group, and 
$\sO(G/G^\circ)\hookrightarrow \sO(G)=k$, so $G=G^\circ$. Also, 
$G/G_\reduced$ is finite, and $\sO(G/G_\reduced)=k$, so $G$ is reduced (hence 
smooth). We use a rigidity lemma: let $\sO(X)=k$, $Y$ be irreducible, and 
if $f:X\times Y\to Z$ is a morphism of schemes 
of finite type such that $f(X\times y_0)=z_0$ for some $y_0\in Y(k)$ and 
$z_0\in Z(k)$, then $f(x,y) = f(x_0,y)$ for all $(x,y)\in X\times Y$. In the 
literature, one often replaces ``$\sO(X)=k$'' with ``$X$ proper.'' 

In our case, define $G\times H \to H$ by $(g,h)\mapsto f(g) h f(g)^{-1} h^{-1}$. 
Note that this map is identically $=1$ if and only if our Theorem holds. But 
$G\times 1_H\mapsto 1_H$, so our rigidity lemma gives the result. 
\end{proof}
In particular, $G$ itself is commutative. 

\begin{proof}[Proof of rigidity lemma]
We use infinitesimal neighborhoods. The point $y_0\in Y(k)$ can be written 
as $y_0=\spectrum(\sO_{Y,y_0}/\fm)$. For each $n$, define 
$y_n = \spectrum(\sO_{Y,y_0}/\fm^{n+1})$. Then $\{y_n:n\geqslant 0\}$ is 
an increasing sequence of closed subschemes of $Y$, and the union 
$\bigcup y_n$ is dense in $Y$. (This is a reformulation of Krull's 
intersection theorem, which says that $\bigcap \fm^n=0$.) We claim that 
$f:X\times y_n \to z_n$ for all $n$, where $n$ is defined in the obvious 
way.  So $f_n(x,y) = f_n(x_0,y)$ identically. Let 
$W\subset X\times Y$ be defined by $f(x,y) = f(x_0,y)$. If 
$g:X\times Y\to Z\times Z$ is $(f,f(x_0,-))$, then 
$W=g^{-1}(\Delta_Z)$, and contains $X\times y_n$ for all 
$n$. By our density argument, $W=X\times Y$. 
\end{proof}

By our rigidity lemma, abelian varieties are commutative. Moreover, if 
$f:A\to G$ is a morphism of schemes, $G$ is a connected algebraic group, 
and $f(0)=1$, then $f$ is a homomorphism of group schemes. To see this, 
consider the morphism $(x,y)\mapsto f(x+y) f(y)^{-1} f(x)^{-1}$ from 
$A\times A$ to $G$. It sends $A\times 0$ and $0\times A$ to $1$, so it is 
identically $1$, whence the result. 




We are trying to prove: 

\begin{theo}
Let $G$ be a conneced algebraic group over a perfect field $k$. Then there is a 
exact sequence $1 \to L \to G \to A \to 1$, where $L$ is connected linear and 
$A$ is an abelian variety. 
\end{theo}

First we need some preliminaries on abelian varieties. If $A$ is an abelian 
variety, we will denote the group law on $A$ by $+$ and the neutral element 
by $0$. We have shown that every morphism (of $k$-schemes) $A\to G$ which 
preserves neutral elements is a homomorphism with central image. It is also 
true that (scheme-theoretic) morphisms from affine groups to abelian varieties 
are morphisms 

\begin{prop}
An abelian variety contains no rational curve. 
\end{prop}
\begin{proof}
We need to prove that morphisms $f:\dP_k^1 \to A$ are constant. Let $C$ be 
the image of $f$ in $A$. We have $k(C)\subset k(\dP^1)$, so 
$\widetilde C\simeq \dP^1$. We may assume $f$ is generically smooth on its 
image. We have 
$d f:T_{\dP^1} = \sO_{\dP^1}(2) \to f^\ast T_A = \sO_{\dP^1}\otimes \lie A$, 
non-zero by our assumption. This cannot happen: twist both sides by $-1$ and 
we get $\sO_{\dP^1}(1)$ (which has sections) embedding into 
$\sO_{\dP^1}(-1)$ (which has none). 
\end{proof}

\begin{theo}[Weil extension]
Let $f:X\to A$ be a rational map, where $X$ is a smooth variety and $A$ is an 
abelian variety. Then $f$ is a morphism. 
\end{theo}

[BLR] has a proof. 

\begin{proof}
Our rational map may be factored via $p_2=f\circ p_1$, where $p_1$ is 
birational and proper. We do this via the graph of $f$:
\[
  \Gamma_f = \text{Zar. cl.}\{(x,f(x)):f\text{ is defined at }x\}\subset X\times A .
\]
Then $\Gamma_f \to X$ is birational and proper. There is a rational curve 
$C|subset Y=\Gamma_f$ contracted by $p_1$ [O. Debarre: Higher-dimensional 
algebraic geometry, 1.4.3]. Thus $C\subset x\times A$, a contradiction. 
\end{proof}

\begin{prop}
Let $f:X\times Y\to A$ be a morphism. Let $x_0\in X(k)$, $y_0\in Y(k)$ be 
smooth. Then $f(x,y)=f(x_0,y) + f(x,y_0) - f(x_0,y_0)$. 
\end{prop}
\begin{proof}
We want to reduce things to a rigidity lemma from earlier. Without loss of 
generality, $X$ and $Y$ are smooth. Let 
$X\hookrightarrow \overline X$ be a Nagata compactification, and let 
$\overline{X}_\mathrm{sm}$ be its smooth locus (in positive characteristic, 
we only know $\overline X$ is normal). We have 
$\sO(\overline X_\mathrm{sm}) = \sO(\overline X)=k$. We can extend $f$ to a 
morphism $\overline X_\mathrm{sm} \times Y \to A$. Let 
$g(x,y) = f(x,y)-f(x_0,y)-f(x,y_0) + f(x_0,y_0)$. One has 
$g(X,y_0) = 0$, so the rigidity lemma tells us that $g$ only depends on $y$. 
But setting $x=x_0$, we see that $g=0$. 
\end{proof}

\begin{coro}
Let $G$ be a connected algebraic group, $f:G\to A$ a morphim of varieties 
preserving neutral elements. Then $G$ is a homomorphism. 
\end{coro}
\begin{proof}
Consider $G\times G\to A$, $(x,y)\mapsto f(x y)$ and apply the previous 
proposition. 
\end{proof}

\begin{theo}[Rosenlicht]
Let $G$ be a connected algebraic group, $A\subset G$ an abelian subvariety. Then 
there is normal connected subgroup scheme $H\subset G$ such that 
$G=A\cdot H$ and $A\cap H$ is finite. If $k$ is perfect, we may take $H$ 
reduced. 
\end{theo}

\begin{prop}[Weil, Rosenlicht]
Let $G$ be a connected commutative algebraic group, and let $X$ be a (fppf-) 
$G$-torsor over $k$. Then there exists a morphism 
$\varphi:X\to G$ such that $\varphi(g\cdot x)=\varphi(x)+n g$ for some 
$n\in \dZ\smallsetminus 0$. 
\end{prop}
\begin{proof}
If $X(k) \ni x_1$, then $G\to X,g\mapsto g\cdot x_1$ is an isomorphism. In 
general, we can find $x_1\in X(K)$, where $K/k$ is finite Galois. Let 
$\Gamma=\galois(K/k)$. Let $x_1,\dots,x_n$ be the Galois conjugates of $x_1$. 
For $x\in X(\bar k)$, we can write $x=g_i x_i$ for some $g_i\in G(\bar k)$. 
Define $\varphi:X_{\bar k} \to G_{\bar k}$ by $x\mapsto \sum g_i$. This is 
defined over $K$, is $\Gamma$-equivariant, and 
$\varphi(g\cdot x)=n g+ \varphi(x)$. This descends to the desired $\varphi$. 
\end{proof}

If we use Galois cohomology, things become easy. We know that isomorphism 
classes of $G$-torsors over $K$ are classified by the commutative group 
$\h^1(k,G)$. The group operation corresponds to 
$X_1+X_2 = (X_1\times X_2)/(g,-g)$. The set of isomorphism classes of 
$G$-torsors trivial over $K$ is the kernel of 
$\h^1(k,G) \to \h^1(K,G)$, traditionally denoted $\h^1(\Gamma,G(K))$. This is 
killed by $\# \Gamma$. 

\begin{proof}[Proof of ``main theorem'']
If $k$ is perfect, we may take $H$ reduced. Let $q:G\to G/A$ be the quotient 
map. Then $q$ is an $A$-torsor over the generic point of $G/A$. Thus there 
exists $\varphi:G_{k(G/A)} \to A_{k(G/A)}$, hence a rational map 
$G\to A$, such that $\varphi(a g)=\varphi(g)+n a$ when defined. By Weil's 
extension theorem, $\varphi$ is a morphism. Also, we may assume $1_G \mapsto 0$. 
It turns out that $\varphi$ is a homomorphism. Let $H=(\ker\varphi)^\circ$. Then 
$A\cap H\subset \ker(\varphi|_A) = \ker(n_A)$. The last group is finite. 
Also, $\varphi|_A$ is surjective. Thse facts easily imply that 
$G=A\cdot \ker(\varphi) = A\cdot H$. 
\end{proof}

We used the fact that $n_A:A\to A$ is an isogeny for $n\in \dZ\smallsetminus 0$. 
If $n$ is invertible in $k$, things are easy. One has 
$\lie(\prescript{}{n}{A}) = \ker(n:\lie A\to \lie A)$, and this is zero if 
$n\in k^\times$. So $n_A$ is \'etale at $0$, hence everywhere by translation. 
By dimension considerations, $n_A$ is finite and surjective. For the general 
case, see \cite{m08}. 




\subsection{Applications}

\begin{coro}[Poincar\'e reducibility]
Let $G$ be an abelian variety, $A\subset G$ an abelian subvariety. Then 
$G=A + B$, where $B$ is an abelian variety with $A\cap B$ finite. 
\end{coro}
\begin{proof}
We have a commutative diagram:
\[\xymatrix{
  0 \ar[r] 
    & A \ar[r] \ar@{=}[d] 
    & A' \ar[r] \ar[d] 
    & G/A \ar[r] \ar[d] \ar@{.>}[dl] 
    & 0 \\
  0 \ar[r] 
    & A \ar[r] 
    & G \ar[r]^-q 
    & G/A \ar[r] 
    & 0 
}\]
The square on the right is Cartesian, and $\varphi$ yields the dotted map, 
whence $G'\simeq A\times G/A$.   
\end{proof}

\begin{enonce}[remark]{Example}
This example is due to Raynaud, in \cite[XVIII.A3]{sga3}. Let $k$ be an 
imperfect field, $k\subsetneq K$ a purely inseparable field extension. Let 
$H$ be a connected algebraic group over $K$. Consider 
$G=R_{K/k}(H)$. If $H$ is quasi-projective, this exists \cite[A]{cgp10}. There 
is an exat sequence $1 \to U \to G_K\to H \to 1$, where $U$ is connected 
unipotent. If $U\subset V_K$ for some subgroup scheme $V\subset G$, then $V=G$. 
If $H$ is a nontrivial abelian variety, then $G_K$ satisfies theorem 
\ref{thm:A} but not $G$. 
\end{enonce}

It follows from this example that Theorem \ref{thm:A} fails over any 
imperfect field. If $H=A_K$ for an abelian $k$-variety $A$, we have a map 
$A\to R_{K/k}(A_K)=G$. This is the inclusion of a closed subgroup. But the 
image of $A\to G$ has no quasi-complement $L$, because otherwise 
$G/L=A/(A\cap L)$, an abelian variety. This cannot be. 

\begin{proof}[Proof of Theorem A]
We follow \cite{r56}, except in modern language. Let $G$ be a connected 
algebraic group. Then $G$ has a largest connected linear \emph{normal} subgroup 
$L(G)$. Indeed, let $L\subset G$ be connected linear normal maximal, and let 
$L_1\subset G$ satisfy the same properties. Then 
$L\cdot L_1 /L\simeq L-1/(L_1\cap L)$, a linear group. So $L\cdot L_1$ is linear. 
By maximality, $L_1\subset L$. 

It is easy to see that $L(G/L(G))=1$. So we may assume that $G$ has no 
nontrivial connected linear normal subgroups. Such groups are called 
\emph{pseudo-abelian varieties}, after Totaro. We need to show that 
$G$ is proper, i.e.\ pseudo-abelian varieties are abelian. We assume $k=\bar k$. 
See [Totaro, 2013, Ann. ENS] for details. Consider 
$1 \to H \to G \to L' \to 1$, where $L'$ is linear and $\sO(H)=k$. If $H$ is 
proper, we are done by the existence of a quasi-complement: 
$G=H\cdot L''$, where $H\cap L''$ is finite. The map $L'' \to L$ is surjective 
with finite kernel. Since $L''$ is an extension of a linear group by a finite 
one, it is linear. So $G/L''=H/(H\cap L')$ is an abelian variety. 

If $H$ is not proper, we use the following 

\begin{lemm}[Rosenlicht]
Any non-proper connected algebraic group contains a nontrivial linear subgroup. 
\end{lemm}
\begin{proof}[Idea of proof]
If a group scheme acts faithfully on a variety $X$, then 
$\stabilizer_G(x)$ is linear for any $x\in X(k)$. Indeed, $\stabilizer_G(x)$ 
acts on $X_n=\spectrum(\sO_{X,x}/\fm^{n+1})$ for all $n$. There must be a 
faithful action of $\stabilizer_G(x)$ on some $X_n$. But $X_n$ is affine, 
so $\stabilizer_G(x)$ acts faithfully on the finite-dimensional $k$-vector 
space $\sO(X_n)$. Let $G\hookrightarrow X$ be a normal completion so that 
$D=X\smallsetminus G$ is a Cartier divisor. Then $G$ acts rationally on 
$X$ by left multiplication. if $x\in D$ and 
$g\cdot x$ is defined, then $g\cdot x\in D$. Since 
$\dim D=\dim G-1$, all points in $D$ have  
isotropy groups of positive dimension. After positively modifying $D$, we 
assume $G$ acts rationlly on some irreducible component $E$. 

[\ldots didn't understand the end\ldots]
\end{proof}
\end{proof}

Rosenlicht's proof has been rewritten in \cite{bsu13}. Also, see 
\cite{m14}. 

\begin{coro}
Every algebraic group is a quasi-projective variety. 
\end{coro}
\begin{proof}
Work over $\bar k$: use $1 \to L\to  G \xrightarrow\pi A \to 1$. The map 
$\pi$ is an affine morphism, and we know that $A$ is projective. Let $\sL$ 
be an ample line bndle on $A$; then $\pi^\ast\sL$ is ample on $G$. The 
bundle $\pi^\ast\sL$ is defined over some finite extension $K/k$. Then 
$N_{K/k}(\pi^\ast \sL)$ is also ample (and defined over $k$). 
\end{proof}

Let $G$ be a connected algebraic group over a perfect field $k$. Then we 
have an exact sequence 
\[
  1 \to L=G_\mathrm{aff} \to G \xrightarrow\pi A \to 1 ,
\]
where $L$ is affine and $A$ is an abelian variety. 

\begin{prop}
1. $G_\mathrm{aff}$ is the largest connected affine subgroup of $G$. 

2. $\pi$ is the universal morphism (of varieties) to an abelian variety. 
\end{prop}
\begin{proof}
1. Let $H\subset G$ be connected affine. Then $H\to A$ is constant. 

2. Let $f:G\to B$ be a morphism of varieties sending $1$ to $0$. Then 
$f:G_\mathrm{aff} \to B$ is constant, and 
$(G_\mathrm{aff})_{\bar k} \to B_{\bar k}$ has no rational curve. But 
$(G_\mathrm{aff})_{\bar k}$ is rational by general theory. 
\end{proof}

We also have an exact sequence 
\[
  1 \to H \to G \xrightarrow\varphi L' =\spectrum\sO(G) \to 1 ,
\]
where $\sO(H)=k$. We call a group scheme $H$ with 
$\sO(H)=k$ \emph{anti-affine}. We write $H=G_\mathrm{ant}$. It is easy to 
see that $G_\mathrm{ant}$ is the largest anti-affine subgroup of $G$. 

\begin{prop}[Rosenlicht]
$G=G_\mathrm{aff}\cdot G_\mathrm{ant}$ and 
$G_\mathrm{aff}\cap G_\mathrm{ant}\supset (G_\mathrm{ant})_\mathrm{aff}$ with 
finite quotient. 
\end{prop}

We can reformulate this theorem. There is an exact sequence 
\[\xymatrix{
  1 \ar[r] 
    & \frac{G_\mathrm{ant}\cap G_\mathrm{aff}}{(G_\mathrm{ant})_\mathrm{aff}} \ar[r] 
    & \frac{G_\mathrm{aff}\times G_\mathrm{ant}}{(G_\mathrm{ant})_\mathrm{aff}} \ar[r] 
    & G \ar[r] 
    & 1 .
}\]
The group on the left is finite. The group $G_\mathrm{aff}$ is connected 
linear, $G_\mathrm{ant}$ can be completely described, and 
$(G_\mathrm{ant})_\mathrm{aff}$ is either a torus in characteristic $p>0$, or 
of the form $T\times \dG_\additive^n$ ($T$ a torus) in characteristic zero. 

\begin{prop}
Let $G$ be an anti-affine group over any field $k$ of characteristic $p>0$. 
Then $G$ is a \emph{semi-abelian variety}, i.e.\ an extension of an abelian 
variety by a torus. 
\end{prop}
\begin{proof}[Proof (Rosenlicht)]
If $k=\bar k$, we can apply Chevalley's theorem to get 
\[
  0 \to T\times U \to G \to A \to 0 ,
\]
where $T$ is a torus and $U$ is connected commutative unipotent. We want to 
prove that $U=0$. Mod out by $T$ to get 
\[
  0 \to U \to G/T \to A \to 0 ,
\]
where $G/T$ is still anti-affine because $\sO(G/T)=\sO(G)^T$. We have 
$p^n U=0$ for $n\gg 0$, and $p_A^n$ is an isogeny. Thus 
$\ker(p^n_{G/T})$ is an extension of a finite group scheme by $U$. Thus 
$p^n (G/T)\subset G/T$ is an abelian variety, so we can write 
$G/T=(p^n G/T)\cdot H$ for a quasi-complement $H$. But then 
$G/T\twoheadrightarrow H/(H\cap p^n G/T)$, and $H$ is linear (isogenous to 
$U$). This can only happen if $H/(H\cap p^n G/T)=1$, whence the result. 

For arbitrary $k$, the maximal torus $T_{\bar k}\subset G_{\bar k}$ descends to 
a maximal torus of $G$. This follows from a very general theorem of 
Grothendieck on tori. In $T(\bar k)$, we may find $g$ such that 
$\overline{\langle g\rangle} = T_{\bar k}$ (unless $k$ is finite). Then 
$g^{p^n}$ is regular for all $n$. We may assume $g\in T(k^s)$. The rest is 
easy. 
\end{proof}

\begin{defi}
A \emph{pseudo-abelian variety} is a connected algebraic group without 
nontrivial connected linear subgroups. 
\end{defi}


If $k$ is perfect, then Chevalley's theorem tells us that pseudo-abelian 
varieties are abelian. If $k$ is not perfect, these definitions do not 
coincide (see an earlier example of Raynaud). One starts with an abelian 
variety of $A$ over $k$, and puts $G=R_{K/k}(A_K)$ for $K/k$ purely 
inseparable. Basic properties of Weil restriction give us an exact sequence 
\[
  0 \to A \to G \to U \to 0 ,
\]
where $U$ is unipotent. If $A$ is simple, then $G$ is pseudo-abelian. 

\begin{theo}[Totaro]
Any pseudo-abelian variety $G$ is part of an extension 
\[
  0 \to A \to G \to U \to 0 
\]
with $A$ abelian and $U$ connected unipotent. Moreover, $G$ is commutative. 
\end{theo}
\begin{proof}
[\ldots didn't write down\ldots]
\end{proof}

Any connected unipotent $U$ with $p U=0$ occurs in such an extension. 





\subsection{Structure theory for semi-abelian varieties}

Fix a torus $T$ and an abelian variety $A$. We study extensions 
$0 \to T \to G \to A \to 0$. Start with the case $T=\dG_\mult$. Such an 
extension will be a $\dG_\mult$-torsor ($=$ line bundle) over $A$. So 
$\extensions^1(A,\dG_\mult)\hookrightarrow \h^1(A,\dG_\mult)=\picard(A)$. It 
turns out that the image lies in $\picard^\circ(A)$, the subgroup of 
$\picard(A)$ consisting of algebraically trivial line bundles. Recall that 
$L\in\picard(A)$ is \emph{algebraically trivial} if there exists a line bundle 
$\sL$ on $X\times S$ for $S$ a connected variety, such that 
$\sL_{s_1}\simeq L$ for some $s_1\in S(k)$ and $\sL_{s_0}\simeq \sO_A$ for 
some other $s_0\in S(k)$. 

\begin{enonce}{Exercise}
If $A$ is an elliptic curve, then a line bundle is algebraically trivial if and 
only if it has degree zero. 
\end{enonce}

\begin{theo}[Weil, Barsotti]
The map $\extensions^1(A,\dG_\mult) \to \picard^\circ(A)$ is an isomorphism. 
Moreover, $\picard^\circ(A)$ is naturally the group of $k$-rational points of 
an abelian variety $A^\vee$. 
\end{theo}

If we define $\extensions^1(A,\dG_\mult)$ as a functor by 
$\extensions^1(A,\dG_\mult)(S)=\extensions_S^1(A_S,\dG_{\mult,S})$, then 
$\extensions^1(A,\dG_\mult)=A^\vee$. The functor $(-)^\vee$ is an 
anti-equivalence from the category of abelian varieties to itself. 

Let's see how things work. From our exact sequence 
$0 \to \dG_\mult \to G \xrightarrow\pi \to A \to 0$, the sheaf 
$\pi_\ast \sO_G$ is a sheaf of $\sO_A$-algebras with $\dG_\mult$-action, i.e.\ 
$\pi_\ast \sO_G=\bigoplus_{n\in\dZ} L^n$, where $L\in \picard^\circ(A)$ is the 
image of $\extensions^1(A,\dG_\mult)\to \picard^\circ(A)$. 

Next we'll look at extensions of split tori $T\simeq \dG_\mult^n$. More 
invariantly, $T=\hom(\widehat T,\dG_\mult)$. We get 
$\extensions^1(A,T) = \hom(\widehat T,A^\vee(k))$. If we think of things in 
terms of functors, $\extensions^1(A,T)=\hom(\widehat T,A^\vee)$. We get 
$\pi_\ast \sO_G=\bigoplus_{\chi\in \widehat T} L_{c(\chi)}$, where 
$c:\widehat T\to A^\vee(k)$. From this, we get that $G$ is anti-affine 
if and only if $c$ is injective. Indeed, 
$\sO(G)=\bigoplus_{\chi \in \widehat T} \h^0(A,L_{c(\chi)})$ and for 
$L\in \picard^\circ(A)$, $\h^0(A,L)\ne 0$ if and only if $L$ is trivial. 

For arbitrary torus $T$, since $T$ splits over $k^s$, we have 
\[
  \extensions^1(A,T) \isomorphism \hom(\widehat T(k^s),A^\vee(k^s))^\Gamma ,
\]
where $\Gamma=\galois(k^s/k)$. 

\begin{coro}
In characteristic $p>0$, anti-affine groups with abelian part $A$ are 
classified by $\Gamma$-stable lattices in $A^\vee(k^s)$. 
\end{coro}

If $k=\dF_q$ or $\overline{\dF_q}$, then $k=k^s$, and 
$A^\vee(k^s)=\bigcup A^\vee(\dF_{q^{n m}})$, a torsion group. So there are 
no anti-affine groups over finite fields other than abelian varieties: 

\begin{coro}[Arima '61]
Every connected algebraic group $G$ over a finite field is isogenous to 
$G_\mathrm{aff}\times A$, where $G_\mathrm{aff}$ is linear and $A$ is abelian. 
\end{coro}

The kernel of $G_\mathrm{aff}\times A \times A\to G$ is a finite group scheme, 
but there are few other restrictions. 





Let's study anti-affine groups in characteristic zero. 
By considering the exact sequence $0 \to T\times U \to G\to A \to 0$, we get 
that $G$ is anti-affine if and only if both $G/T$ and $G/U$ are. The group 
$G/U$ is a semi-abelian variety. Since we are in characteristic zero, $U$ is a 
vector group, so $G/T$ is a vector extension of $A$. 

[\ldots didn't record proof of this\ldots]

Any abelian variety has a universal vector extension:
\[
  0 \to \h^1(A,\sO_A)^\vee \to E(A) \to A \to 0 .
\]
It is a nontrivial result that 
$\extensions^1(A,\dG_\additive) \isomorphism \h^1(A,\sO)$. This is a theorem of 
Rosenlicht and Serre. 

\begin{prop}
Suppose the base field has characteristic zero. Then $E(A)$ is anti-affine, 
and the anti-affine vector extensions of $A$ are exactly the quotients of 
$E(A)$. 
\end{prop}

In other words, any extension fits into a commutative diagram with pushout on 
the left: 
\[\xymatrix{
  0 \ar[r] 
    & \h^1(A,\sO)^\vee \ar[r] \ar[d] 
    & E(A) \ar[r] \ar[d] 
    & A \ar[r] \ar@{=}[d] 
    & 0 \\
  0 \ar[r] 
    & U \ar[r] 
    & G \ar[r] 
    & A \ar[r] 
    & 0 .
}\]

Future problems are to find analogues of this theory over discrete valuation rings. 
There is a version of the affinization theorem by Raynaud, 
\cite[VI]{sga3}. There is no clear analogue of Chevalley's ``theorem A.'' 
A powerful result is Grothendieck's semistable reduction theorem. 

If $G$ is a connected algebraic group acting on a smooth variety $X$ over a 
perfect eidl $k$, let $\pi:G\to A$ be the universal morphism to the abelian 
part of $G$. Then there exists 
$\varphi:X\to A$ such that $\varphi(g x) = \varphi(x)+n g$ for some fixed 
$n\in\dZ\smallsetminus 0$. 




